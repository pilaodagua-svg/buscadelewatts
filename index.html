<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BovinoTech Pro - Santiago RS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --agro: #1b5e20; --vet: #0277bd; --gold: #fbc02d; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; }
        .header { background: var(--agro); color: white; padding: 25px; text-align: center; border-bottom: 4px solid var(--gold); }
        .container { max-width: 900px; margin: -20px auto 0; padding: 0 15px; }
        #map { height: 350px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 25px; border: 3px solid white; }
        .animal-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .animal-img { width: 100%; height: 250px; object-fit: cover; }
        .info { padding: 20px; }
        .price { font-size: 1.8rem; color: var(--agro); font-weight: bold; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px; }
        .healthy { background: #e8f5e9; color: #2e7d32; }
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 15px 0; font-size: 0.9rem; }
        .btn { display: block; text-align: center; padding: 12px; border-radius: 6px; text-decoration: none; font-weight: bold; margin-top: 10px; }
        .btn-vet { border: 2px solid var(--vet); color: var(--vet); }
    </style>
</head>
<body>

<div class="header">
    <h1>游 BovinoTech Santiago</h1>
    <p>Marketplace Rural & Intelig칡ncia Veterin치ria</p>
</div>

<div class="container">
    <div id="map"></div>
    <div id="feed">
        <p style="text-align:center;">Sincronizando com a Planilha de Santiago...</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // ID da sua planilha confirmada 
    const SHEET_ID = "1siJAnVoA3KwnoQWYtkB-wODIb1j1_YP2VHC-djXnFtg";
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;

    const map = L.map('map').setView([-29.1914, -54.8659], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    async function loadData() {
        try {
            const response = await fetch(CSV_URL);
            const data = await response.text();
            const rows = data.split('\n').slice(1);
            const feed = document.getElementById('feed');
            feed.innerHTML = '';

            rows.forEach((row, i) => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/"/g, '').trim());
                if (cols.length < 5) return;

                const [data, foto, preco, peito, comprimento, coords, saude] = cols;
                
                // C치lculo de Peso Brasileiro (cm/kg)
                const peso = ((Math.pow(parseFloat(peito), 2) * parseFloat(comprimento)) / 11900).toFixed(1);
                const dose = (peso * 0.02).toFixed(2); // Simula칞칚o veterin치ria

                // Adicionar no Feed
                feed.innerHTML += `
                    <div class="animal-card">
                        <img src="${foto.replace('view?usp=drivesdk', 'uc?export=view&id=').split('d/')[1]?.split('/')[0] || foto}" class="animal-img" onerror="this.src='https://via.placeholder.com/400x250?text=Animal+de+Santiago'">
                        <div class="info">
                            <span class="badge healthy">${saude || 'Saud치vel'}</span>
                            <div class="price">R$ ${preco}</div>
                            <div class="stats">
                                <div><strong>丘뒲잺 Peso</strong><br>${peso} kg</div>
                                <div><strong>游늺 Peito</strong><br>${peito} cm</div>
                                <div><strong>游늺 Comp.</strong><br>${comprimento} cm</div>
                            </div>
                            <button class="btn btn-vet" onclick="alert('Dose Sugerida: ${dose} ml (Base 1ml/50kg)')">游뽘 Consultar Dosagem Vet</button>
                            <a href="https://www.google.com/maps?q=${coords}" target="_blank" class="btn" style="background:#e3f2fd; color:#0277bd">游늸 Localizar na Fazenda</a>
                        </div>
                    </div>
                `;

                // Marcar no Mapa
                if(coords) {
                    const [lat, lng] = coords.split(',').map(Number);
                    if(!isNaN(lat)) L.marker([lat, lng]).addTo(map).bindPopup(`<b>Lote #${i+1}</b><br>Peso: ${peso}kg`);
                }
            });
        } catch (e) {
            feed.innerHTML = "<p style='text-align:center'>Ative 'Publicar na Web' na Planilha!</p>";
        }
    }
    loadData();
</script>
</body>
</html>
